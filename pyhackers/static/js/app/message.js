// Generated by CoffeeScript 1.6.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.Message = (function() {
    function Message() {
      this.showMessage = __bind(this.showMessage, this);
      this.listen();
    }

    Message.prototype.listen = function() {
      var _this = this;
      $(document).on('click', '[data-trigger="message"]', function(evt) {
        return _this.showMessage(evt);
      });
      return $(document).on('click', '[data-trigger="upvote"]', function(evt) {
        return _this.upvote(evt);
      });
    };

    Message.prototype.upvote = function(evt) {
      var messageId;
      $(evt.target).css({
        color: 'orange'
      });
      messageId = $(evt.currentTarget).parents('[data-message-id]').attr("data-message-id");
      evt.stopPropagation();
      evt.preventDefault();
      return $.post("/ajax/message/" + messageId + "/upvote", {
        message: messageId
      }, function(data) {
        return console.log(data);
      });
    };

    Message.prototype.showMessage = function(evt) {
      return vex.dialog.open({
        message: "Whats up",
        input: "<textarea rows=\"3\" name=\"message\" required ></textarea>",
        buttons: [
          $.extend({}, vex.dialog.buttons.YES, {
            text: 'Post'
          }), $.extend({}, vex.dialog.buttons.NO, {
            text: 'Back',
            "class": 'pull-left'
          })
        ],
        callback: function(data) {
          if (data === false) {
            return console.log('Cancelled');
          }
          console.log('Username', data.message);
          return $.post('/ajax/message/new', {
            message: data.message
          }, function() {
            console.log("Ok");
            return Messenger().post({
              message: "Message has been sent",
              type: "success"
            });
          });
        }
      });
    };

    return Message;

  })();

  jQuery(function() {
    var msg;
    return msg = new Message();
  });

}).call(this);
