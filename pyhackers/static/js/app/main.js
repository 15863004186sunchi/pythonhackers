// Generated by CoffeeScript 1.6.3
(function() {
  var Application, img_quicky,
    _this = this;

  img_quicky = function(path, ref, cp, htag) {
    var i, ts, url;
    ts = (new Date()).getTime();
    url = "http://pythonhackers.com/gitbeacon?_=" + ts + "&r=" + ref + "&p=" + path + "&cp=" + cp;
    i = document.createElement("img");
    i.setAttribute('src', url);
    i.setAttribute('alt', 'a');
    i.setAttribute('height', '1px');
    i.setAttribute('width', '1px');
    return document.body.appendChild(i);
  };

  Application = {
    begin: function() {
      return $(this.load);
    },
    mixevents: function() {
      $("#mc_embed_signup").on("show.bs.modal", function() {
        return mixpanel.track("signup-popup");
      });
      return $(document).on('click', 'a', function(evt) {
        var hashtag, href,
          _this = this;
        href = $(evt.currentTarget).attr('href');
        hashtag = href[0] === "#";
        img_quicky(encodeURIComponent(href), encodeURIComponent(document.referrer), encodeURIComponent(document.location.pathname), hashtag);
        if (hashtag) {
          return;
        }
        evt.stopPropagation();
        evt.preventDefault();
        return window.setTimeout(function() {
          return document.location = href;
        }, 300);
      });
    },
    load: function() {
      Application.formSubmitter();
      return Application.mixevents();
    },
    captureSubmit: function($el) {
      var action, id, slug;
      action = $el.attr("action");
      if (!(action == null)) {
        action = action.replace("/ajax/", "");
      }
      id = $('[name="id"]', $el).val();
      slug = $('[name="slug"]', $el).val();
      return mixpanel.track(action, {
        referrer: document.referrer,
        id: id,
        slug: slug
      });
    },
    formSubmitter: function() {
      $('form[data-remote]').submit(function(evt) {
        var $this, action, postData;
        evt.preventDefault();
        evt.stopPropagation();
        Application.captureSubmit($(evt.currentTarget));
        if (!window.session.hasOwnProperty("id")) {
          document.location = '/authenticate';
          return;
        }
        $this = $(this);
        action = $this.attr("action");
        postData = $this.serializeArray();
        return $.post(action, postData);
      });
      return $('[data-toggle="tooltip"]').tooltip();
    }
  };

  Application.begin();

}).call(this);
